{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "c7d3a6bc-3bea-4dd4-81ff-6b0bd954d484",
   "metadata": {},
   "source": [
    "## Setup Environment"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "58e39689-a48a-4a1e-9493-2f9296a804f3",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\ngzhe\\Anaconda3\\lib\\site-packages\\numpy\\_distributor_init.py:30: UserWarning: loaded more than 1 DLL from .libs:\n",
      "C:\\Users\\ngzhe\\Anaconda3\\lib\\site-packages\\numpy\\.libs\\libopenblas.fb5ae2tyxyh2ijrdkgdgq3xbklktf43h.gfortran-win_amd64.dll\n",
      "C:\\Users\\ngzhe\\Anaconda3\\lib\\site-packages\\numpy\\.libs\\libopenblas64__v0.3.21-gcc_10_3_0.dll\n",
      "  warnings.warn(\"loaded more than 1 DLL from .libs:\"\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Setup complete. Using torch 1.13.0+cpu (CPU)\n",
      "0.14.0+cpu\n"
     ]
    }
   ],
   "source": [
    "# #clone YOLOv5 and \n",
    "# !git clone https://github.com/ultralytics/yolov5  # clone repo\n",
    "# %cd yolov5\n",
    "# %pip install -qr requirements.txt # install dependencies\n",
    "\n",
    "import torch\n",
    "import os\n",
    "from IPython.display import Image, clear_output  # to display images\n",
    "import torchvision\n",
    "\n",
    "print(f\"Setup complete. Using torch {torch.__version__} ({torch.cuda.get_device_properties(0).name if torch.cuda.is_available() else 'CPU'})\")\n",
    "print(torchvision.__version__)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "46ecc422-87ed-4633-a39c-b1ae4e4ff269",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pathlib\n",
    "temp = pathlib.PosixPath\n",
    "pathlib.PosixPath = pathlib.WindowsPath"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "id": "7ec789d9-f3c8-4f98-b929-5b9fe6c26875",
   "metadata": {},
   "outputs": [],
   "source": [
    "# import torch\n",
    "device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n",
    "path = 'Week_8.pt' #'exp5/weights/best.pt' #\"Week_8.pt'"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5da7ef2c-1c5a-4058-bf24-3358c36149e1",
   "metadata": {},
   "source": [
    "## Load Model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 42,
   "id": "ecee96c7-6b49-4c02-9e9b-d7149b3103f3",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "YOLOv5  2024-2-29 Python-3.8.18 torch-1.13.0+cpu CPU\n",
      "\n",
      "Fusing layers... \n",
      "Model summary: 157 layers, 7093732 parameters, 0 gradients, 16.0 GFLOPs\n",
      "Adding AutoShape... \n"
     ]
    }
   ],
   "source": [
    "# model = torch.hub.load('ultralytics/yolov5', 'custom', path=path, force_reload=True,trust_repo=True)\n",
    "model = torch.hub.load('ultralytics_yolov5_master', 'custom', path=path, force_reload=True,trust_repo=True, source='local')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "45164b21-7d39-403b-a305-abce4586a869",
   "metadata": {},
   "source": [
    "## Test on one Sample Picture"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "2f725670-e918-4b75-9cc4-beea1c80423f",
   "metadata": {},
   "outputs": [],
   "source": [
    "# https://github.com/ultralytics/yolov5/issues/36\n",
    "# Image\n",
    "im = \"predicted_B_actual_1.png\" #\"D_frame_0256.png\"#'Picture1.png' #'https://ultralytics.com/images/zidane.jpg'\n",
    "\n",
    "# Inference\n",
    "results = model(im)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "3afe37c5-89fc-4487-a427-97ed2d52b924",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "image 1/1: 480x640 1 B\n",
      "Speed: 39.9ms pre-process, 456.1ms inference, 10.0ms NMS per image at shape (1, 3, 480, 640)\n"
     ]
    }
   ],
   "source": [
    "print(results)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "55cd805c-62f9-4b1b-a698-2e6a3edb4ca8",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "xmin          279.663361\n",
      "ymin          273.177338\n",
      "xmax          316.657501\n",
      "ymax           323.46524\n",
      "confidence      0.841493\n",
      "class                  1\n",
      "name                   B\n",
      "Name: 0, dtype: object\n",
      "B\n"
     ]
    }
   ],
   "source": [
    "#results_df = results.pandas().xyxy[0]\n",
    "df_results = results.pandas().xyxy[0]\n",
    "for _, row in df_results.iterrows():\n",
    "    print(row)\n",
    "    label = row['name']\n",
    "\n",
    "print(label)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d25be8e6-64c0-4d31-a003-416ef8942d20",
   "metadata": {},
   "source": [
    "# For Loop over all Images in Folder"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "id": "6f4a9dff-e5d5-46a8-bec2-1b2971b32dc7",
   "metadata": {},
   "outputs": [],
   "source": [
    "# create folder to store stuff to label\n",
    "import os\n",
    "import shutil\n",
    "\n",
    "if not os.path.exists('incorrect_predictions_task2'):\n",
    "    os.makedirs('incorrect_predictions_task2')\n",
    "\n",
    "if not os.path.exists('correct_predictions_task2'):\n",
    "    os.makedirs('correct_predictions_task2')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "id": "176f5236-78f1-4521-8508-e17d8cd449d5",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Left\n",
      "Leftessing: 99\n",
      "---------------- WRONG PREDICTION for 1.png ----------------\n",
      "GROUNDTRUTH: Left\n",
      "PREDICTION: Y\n",
      "Task2\\Left_NEW\\1.png\n",
      "Rightssing: 199\n",
      "---------------- WRONG PREDICTION for 1.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\1.png\n",
      "---------------- WRONG PREDICTION for 10.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\10.png\n",
      "---------------- WRONG PREDICTION for 11.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\11.png\n",
      "---------------- WRONG PREDICTION for 13.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\13.png\n",
      "---------------- WRONG PREDICTION for 14.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\14.png\n",
      "---------------- WRONG PREDICTION for 15.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\15.png\n",
      "---------------- WRONG PREDICTION for 16.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\16.png\n",
      "---------------- WRONG PREDICTION for 17.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\17.png\n",
      "---------------- WRONG PREDICTION for 18.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\18.png\n",
      "---------------- WRONG PREDICTION for 20.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\20.png\n",
      "---------------- WRONG PREDICTION for 21.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\21.png\n",
      "---------------- WRONG PREDICTION for 22.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\22.png\n",
      "---------------- WRONG PREDICTION for 23.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\23.png\n",
      "---------------- WRONG PREDICTION for 24.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\24.png\n",
      "---------------- WRONG PREDICTION for 29.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\29.png\n",
      "---------------- WRONG PREDICTION for 30.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\30.png\n",
      "---------------- WRONG PREDICTION for 31.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\31.png\n",
      "---------------- WRONG PREDICTION for 32.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\32.png\n",
      "---------------- WRONG PREDICTION for 33.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\33.png\n",
      "---------------- WRONG PREDICTION for 34.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\34.png\n",
      "---------------- WRONG PREDICTION for 36.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\36.png\n",
      "---------------- WRONG PREDICTION for 37.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\37.png\n",
      "---------------- WRONG PREDICTION for 38.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\38.png\n",
      "---------------- WRONG PREDICTION for 39.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\39.png\n",
      "---------------- WRONG PREDICTION for 40.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\40.png\n",
      "---------------- WRONG PREDICTION for 41.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\41.png\n",
      "---------------- WRONG PREDICTION for 42.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\42.png\n",
      "---------------- WRONG PREDICTION for 43.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\43.png\n",
      "---------------- WRONG PREDICTION for 44.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\44.png\n",
      "---------------- WRONG PREDICTION for 45.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\45.png\n",
      "---------------- WRONG PREDICTION for 46.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\46.png\n",
      "---------------- WRONG PREDICTION for 5.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\5.png\n",
      "---------------- WRONG PREDICTION for 50.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\50.png\n",
      "---------------- WRONG PREDICTION for 51.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\51.png\n",
      "---------------- WRONG PREDICTION for 52.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\52.png\n",
      "---------------- WRONG PREDICTION for 53.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\53.png\n",
      "---------------- WRONG PREDICTION for 56.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\56.png\n",
      "---------------- WRONG PREDICTION for 57.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\57.png\n",
      "---------------- WRONG PREDICTION for 58.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\58.png\n",
      "---------------- WRONG PREDICTION for 59.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\59.png\n",
      "---------------- WRONG PREDICTION for 6.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\6.png\n",
      "---------------- WRONG PREDICTION for 60.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\60.png\n",
      "---------------- WRONG PREDICTION for 62.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\62.png\n",
      "---------------- WRONG PREDICTION for 66.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\66.png\n",
      "---------------- WRONG PREDICTION for 68.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\68.png\n",
      "---------------- WRONG PREDICTION for 7.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\7.png\n",
      "---------------- WRONG PREDICTION for 70.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\70.png\n",
      "---------------- WRONG PREDICTION for 72.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\72.png\n",
      "---------------- WRONG PREDICTION for 74.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\74.png\n",
      "---------------- WRONG PREDICTION for 75.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\75.png\n",
      "---------------- WRONG PREDICTION for 76.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\76.png\n",
      "---------------- WRONG PREDICTION for 77.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\77.png\n",
      "---------------- WRONG PREDICTION for 8.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\8.png\n",
      "---------------- WRONG PREDICTION for 80.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\80.png\n",
      "---------------- WRONG PREDICTION for 81.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\81.png\n",
      "---------------- WRONG PREDICTION for 82.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\82.png\n",
      "---------------- WRONG PREDICTION for 83.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\83.png\n",
      "---------------- WRONG PREDICTION for 85.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\85.png\n",
      "---------------- WRONG PREDICTION for 87.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\87.png\n",
      "---------------- WRONG PREDICTION for 9.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\9.png\n",
      "---------------- WRONG PREDICTION for 91.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\91.png\n",
      "---------------- WRONG PREDICTION for 92.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\92.png\n",
      "---------------- WRONG PREDICTION for 93.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\93.png\n",
      "---------------- WRONG PREDICTION for 95.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\95.png\n",
      "---------------- WRONG PREDICTION for 97.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\97.png\n",
      "---------------- WRONG PREDICTION for 98.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\98.png\n",
      "---------------- WRONG PREDICTION for 99.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_bright\\99.png\n",
      "Right\n",
      "---------------- WRONG PREDICTION for 11.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Y\n",
      "Task2\\Right_NEW\\11.png\n",
      "---------------- WRONG PREDICTION for 12.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\12.png\n",
      "---------------- WRONG PREDICTION for 13.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\13.png\n",
      "---------------- WRONG PREDICTION for 14.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\14.png\n",
      "---------------- WRONG PREDICTION for 18.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\18.png\n",
      "---------------- WRONG PREDICTION for 19.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\19.png\n",
      "---------------- WRONG PREDICTION for 21.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\21.png\n",
      "---------------- WRONG PREDICTION for 26.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\26.png\n",
      "---------------- WRONG PREDICTION for 27.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\27.png\n",
      "---------------- WRONG PREDICTION for 29.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\29.png\n",
      "---------------- WRONG PREDICTION for 32.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\32.png\n",
      "---------------- WRONG PREDICTION for 33.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\33.png\n",
      "---------------- WRONG PREDICTION for 35.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\35.png\n",
      "---------------- WRONG PREDICTION for 36.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\36.png\n",
      "---------------- WRONG PREDICTION for 37.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\37.png\n",
      "---------------- WRONG PREDICTION for 39.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\39.png\n",
      "---------------- WRONG PREDICTION for 40.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\40.png\n",
      "---------------- WRONG PREDICTION for 41.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\41.png\n",
      "---------------- WRONG PREDICTION for 42.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\42.png\n",
      "---------------- WRONG PREDICTION for 54.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Y\n",
      "Task2\\Right_NEW\\54.png\n",
      "---------------- WRONG PREDICTION for 58.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\58.png\n",
      "---------------- WRONG PREDICTION for 66.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\66.png\n",
      "---------------- WRONG PREDICTION for 7.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\7.png\n",
      "---------------- WRONG PREDICTION for 72.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\72.png\n",
      "---------------- WRONG PREDICTION for 75.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\75.png\n",
      "---------------- WRONG PREDICTION for 76.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\76.png\n",
      "---------------- WRONG PREDICTION for 77.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\77.png\n",
      "---------------- WRONG PREDICTION for 8.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\8.png\n",
      "---------------- WRONG PREDICTION for 81.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\81.png\n",
      "---------------- WRONG PREDICTION for 84.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Y\n",
      "Task2\\Right_NEW\\84.png\n",
      "---------------- WRONG PREDICTION for 85.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\85.png\n",
      "---------------- WRONG PREDICTION for 86.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\86.png\n",
      "---------------- WRONG PREDICTION for 93.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\93.png\n",
      "---------------- WRONG PREDICTION for 96.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\96.png\n",
      "---------------- WRONG PREDICTION for 98.png ----------------\n",
      "GROUNDTRUTH: Right\n",
      "PREDICTION: Up\n",
      "Task2\\Right_NEW\\98.png\n",
      "Processing: 399\r"
     ]
    }
   ],
   "source": [
    "directory_with_images = \"Task2\"\n",
    "counter = 0\n",
    "\n",
    "for root, dirs, files in os.walk(directory_with_images):\n",
    "    if len(dirs)==0: # look in root for groundtruth/folder name\n",
    "        # print(root)\n",
    "        groundtruth = root.split(\"\\\\\")[1].split('_')[0]\n",
    "        print(groundtruth)\n",
    "                                 \n",
    "    for img in files:        \n",
    "        # counter to track progress\n",
    "        print(\"Processing: \" + str(counter), end='\\r')\n",
    "        \n",
    "        img_path = os.path.join(root, img)\n",
    "        # extract groundtruth from folder (for light/dark images)      \n",
    "        # groundtruth = img.split('_')[0]\n",
    "        \n",
    "        # get prediction\n",
    "        results = model(img_path)\n",
    "        #print(results)\n",
    "        \n",
    "        df_results = results.pandas().xyxy[0]\n",
    "        for _, row in df_results.iterrows():\n",
    "            predictions = row['name']            \n",
    "\n",
    "        #print(predictions)\n",
    "        counter += 1\n",
    "        \n",
    "        if groundtruth.lower().strip() != predictions.lower().strip():\n",
    "            print('---------------- WRONG PREDICTION for ' + img + ' ----------------')\n",
    "            print('GROUNDTRUTH: ' + groundtruth)\n",
    "            print('PREDICTION: ' + predictions)\n",
    "\n",
    "            print(img_path)\n",
    "            shutil.copyfile(img_path, \"incorrect_predictions_Task2/\"+ \"predicted_\" + predictions + \"_actual_\" + groundtruth + '_' + img)\n",
    "\n",
    "        else:\n",
    "            # Save the predicted text file to disk\n",
    "            # continue\n",
    "            names = ['A', 'B', 'Bullseye', 'C', 'D', 'Down', 'E', 'Eight', 'F', 'Five', 'Four', 'G', 'H', 'Left', 'Nine', 'One', 'Right', 'S', 'Seven', 'Six', 'Stop', 'T', 'Three', 'Two', 'U', 'Up', 'V', 'W', 'X', 'Y', 'Z']\n",
    "            \n",
    "            shutil.copyfile(img_path, \"correct_predictions_Task2/\" + predictions + \"_\" + img)\n",
    "            \n",
    "            with open(\"correct_predictions_task2/\" + predictions + \"_\" + img.replace(\".png\",\"\") + \".txt\", 'w') as file:\n",
    "                for prediction in df_results.iterrows():\n",
    "                    img_width = 640\n",
    "                    img_height = 480\n",
    "                    \n",
    "                    # label_id center_x center_y width height\n",
    "                    center_x = (row['xmax'] + row['xmin']) / 2\n",
    "                    center_y = (row['ymax'] + row['ymin']) / 2\n",
    "                    width = row['xmax'] - row['xmin']\n",
    "                    height = row['ymax'] - row['ymin']\n",
    "\n",
    "                    # class_id center_x center_y width height\n",
    "                    file.write(f\"{names.index(row['name'])} {center_x / img_width} {center_y / img_height} {width / img_width} {height / img_height}\")\n",
    "                    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 48,
   "id": "7590475b-848c-4255-9652-90fb93d1fd4d",
   "metadata": {},
   "outputs": [],
   "source": [
    "\n",
    "                    # old(?) format?\n",
    "                    # x1 y1 x2 y2 x3 y3 x4 y4 label\n",
    "                    # start frm top left, go clockwise i think\n",
    "                    # file.write(f\"{int(row['xmin'])} {int(row['ymax'])} {int(row['xmax'])} {int(row['ymax'])} {int(row['xmax'])} {int(row['ymin'])} {int(row['xmin'])} {int(row['ymin'])} {row['name']} 0\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "9d159258-7ddb-476c-a954-1de4a55bc537",
   "metadata": {},
   "outputs": [],
   "source": [
    "# BRIGHT\n",
    "# total 1308 wrongly predicted images out of 10572 images\n",
    "# ~12% error rate / wrong prediction for bright/harsh lighting\n",
    "\n",
    "\n",
    "# Finetuned Model\n",
    "# 712 wrongly predicted out of 10572"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "id": "c70be4f2-eaed-4eca-8b04-a7f6daddbd53",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "finished2\n"
     ]
    }
   ],
   "source": [
    "print('finished2')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "c13c3ae2-c883-4a52-b9e0-b9a2fe8c26db",
   "metadata": {},
   "outputs": [],
   "source": [
    "# DARK\n",
    "# total 889 out of 9138\n",
    "\n",
    "# out of 8.9k 2nd run"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "31874621-4175-4a47-871e-c01ce8024cc6",
   "metadata": {},
   "source": [
    "## Upload Annotations and Images to Roboflow"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "2cf77159-89a5-486c-b48e-bc021c5b3056",
   "metadata": {},
   "outputs": [],
   "source": [
    "# # ref: https://docs.roboflow.com/datasets/adding-data/upload-api\n",
    "# from roboflow import Roboflow\n",
    "# rf = Roboflow(api_key=\"hIF4rYqw7OqIZvcrrRyB\")\n",
    "# project = rf.workspace(\"mdpfinetuning\").project(\"mdp_finetuning_images\")\n",
    "# # dataset = project.version(1).download(\"yolov5\")\n",
    "\n",
    "# # Retrieve your current workspace and project name\n",
    "# print(rf.workspace())\n",
    "\n",
    "# # Upload the image to your project\n",
    "# project.upload(\"UPLOAD_IMAGE.jpg\")\n",
    "\n",
    "# \"\"\"\n",
    "# Optional Parameters:\n",
    "# - num_retry_uploads: Number of retries for uploading the image in case of failure.\n",
    "# - batch_name: Upload the image to a specific batch.\n",
    "# - split: Upload the image to a specific split.\n",
    "# - tag: Store metadata as a tag on the image.\n",
    "# - sequence_number: [Optional] If you want to keep the order of your images in the dataset, pass sequence_number and sequence_size..\n",
    "# - sequence_size: [Optional] The total number of images in the sequence. Defaults to 100,000 if not set.\n",
    "# \"\"\"\n",
    "\n",
    "# project.upload(\n",
    "#     image_path=\"UPLOAD_IMAGE.jpg\",\n",
    "#     batch_name=\"YOUR_BATCH_NAME\",\n",
    "#     split=\"train\",\n",
    "#     num_retry_uploads=3,\n",
    "#     tag=\"YOUR_TAG_NAME\",\n",
    "#     # sequence_number=99,\n",
    "#     # sequence_size=100\n",
    "# )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fc0c878d-60cd-41c5-8d0f-86e5f79d4979",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.18"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
